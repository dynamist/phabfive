<VirtualHost *:80>
  ServerName phabricator.domain.tld

  DocumentRoot /app/phorge/webroot

  # SetEnv PHABRICATOR_ENV www

  RewriteEngine on

  # Allow longer URLs for phatality / form prefill
  LimitRequestLine 16384

  <Directory "/app/phorge/webroot">
    Options Indexes FollowSymLinks MultiViews
    Require all granted
  </Directory>

  # needed to allow http basic auth (using https auth)
  SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

  # php-fpm
  # <FilesMatch \.php$>
  #     SetHandler "proxy:unix:/run/php/fpm-www.sock|fcgi://localhost/"
  # </FilesMatch>

  LogLevel warn
  ErrorLog /var/log/apache2/phabricator_error.log
  CustomLog /var/log/apache2/phabricator_access.log combined
  ServerSignature Off

  RewriteRule ^/rsrc/(.*)     -                       [L,QSA]
  RewriteRule ^/favicon.ico   -                       [L,QSA]
  RewriteRule ^/project/sprint/board/(.*) /project/board/$1 [L,QSA,R=301]
  RewriteRule ^/maniphest/task/create/? /maniphest/task/edit/form/1/ [L,QSA,NE,R=301]
  RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]

</VirtualHost>
